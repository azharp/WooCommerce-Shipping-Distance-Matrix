!function(e){"use strict";var t={_inputLatId:"",_inputLngId:"",_mapWrapperId:"",_mapSearchId:"",_mapCanvasId:"",_zoomLevel:16,_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",init:function(t){var o=this;o._params=t,o._inputLatSel="woocommerce_"+o._params.method_id+"_origin_lat",o._inputLngSel="woocommerce_"+o._params.method_id+"_origin_lng",o._mapWrapperSel=o._params.method_id+"-map-wrapper",o._mapSearchSel=o._params.method_id+"-map-search",o._mapCanvasSel=o._params.method_id+"-map-canvas",o._params.show_settings&&setTimeout(function(){for(var t=!1,a=e(document).find(".wc-shipping-zone-method-type"),n=0;n<a.length;n++){var r=a[n];if(e(r).text()==o._params.method_title)return e(r).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(t=!0)}t||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(o._params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===o._params.method_title&&(o._initGoogleMaps(),e("#woocommerce_wcsdm_gmaps_api_units").trigger("change"),e("#woocommerce_wcsdm_charge_per_distance_unit").trigger("change"))}),e(document).on("change","#"+o._inputLatSel+", #"+o._inputLngSel,function(){e(".gm-err-content").length||o._initGoogleMaps()}),e(document).on("change","#woocommerce_wcsdm_gmaps_api_units",function(){e("#rates-list-table").removeClass("metric imperial").addClass(e(this).val()),e("#per_distance_unit_selected").text(e(this).find("option:selected").text())}),e(document).on("change","#woocommerce_wcsdm_charge_per_distance_unit",function(){e(this).is(":checked")?(e("#rates-list-table").addClass("charge-per-distance"),e("#woocommerce_wcsdm_ceil_distance").closest("tr").show()):(e("#rates-list-table").removeClass("charge-per-distance"),e("#woocommerce_wcsdm_ceil_distance").closest("tr").hide())}),e(document).on("click","#rates-list-table tbody .select-item",o._selectRateRows),e(document).on("click","#rates-list-table thead .select-item",o._toggleRateRows),e(document).on("click","#rates-list-table a.add",o._addRateRows),e(document).on("click","#rates-list-table a.remove_rows",o._removeRateRows)},_initGoogleMaps:function(t){var o=this;e("#"+o._mapWrapperSel).show().siblings(".description").hide();try{if("undefined"==typeof google||void 0===google.maps)throw"google is not defined";o._buildGoogleMaps()}catch(t){e.getScript("https://maps.googleapis.com/maps/api/js?key="+o._decode(e("#map-secret-key").val())+"&libraries=geometry,places&&language="+o._params.language,function(){o._buildGoogleMaps()})}},_buildGoogleMaps:function(){var t=this,o=-6.175392,a=106.827153,n=e("#"+t._inputLatSel).val(),r=e("#"+t._inputLngSel).val(),s={lat:n=n.length?parseFloat(n):o,lng:r=r.length?parseFloat(r):a},c=wp.template(t._mapCanvasSel),i=wp.template(t._mapSearchSel);e("#"+t._mapCanvasSel).length||e("#"+t._mapWrapperSel).append(c({map_canvas_id:t._mapCanvasSel}));var d=[],l=new google.maps.Map(document.getElementById(t._mapCanvasSel),{center:s,zoom:t._zoomLevel,mapTypeId:"roadmap"}),p=new google.maps.Marker({map:l,position:s,draggable:!0,icon:t._params.marker}),m=new google.maps.InfoWindow({maxWidth:350});n==o&&r==a?(m.setContent(t._params.txt.drag_marker),m.open(l,p)):t._setLatLng(p.position,p,l,m),google.maps.event.addListener(p,"dragstart",function(e){m.close()}),google.maps.event.addListener(p,"dragend",function(e){t._setLatLng(e.latLng,p,l,m)}),d.push(p),e("#"+t._mapSearchSel).length||e("#"+t._mapWrapperSel).append(i({map_search_id:t._mapSearchSel}));var g=document.getElementById(t._mapSearchSel),h=new google.maps.places.SearchBox(g);l.controls[google.maps.ControlPosition.TOP_LEFT].push(g),l.addListener("bounds_changed",function(){h.setBounds(l.getBounds())}),h.addListener("places_changed",function(){var e=h.getPlaces();if(0!==e.length){d.forEach(function(e){e.setMap(null)}),d=[];var o=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(p=new google.maps.Marker({map:l,position:e.geometry.location,draggable:!0,icon:t._params.marker}),t._setLatLng(e.geometry.location,p,l,m),google.maps.event.addListener(p,"dragstart",function(e){m.close()}),google.maps.event.addListener(p,"dragend",function(e){t._setLatLng(e.latLng,p,l,m)}),d.push(p),e.geometry.viewport?o.union(e.geometry.viewport):o.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),l.fitBounds(o)}}),setInterval(function(){e(".gm-err-content").length&&(e("#"+t._mapWrapperSel).hide().siblings(".description").show(),e("#"+t._mapSearchSel).remove(),google=void 0)},1e3)},_setLatLng:function(t,o,a,n){(new google.maps.Geocoder).geocode({latLng:t},function(e,t){t==google.maps.GeocoderStatus.OK&&e[0]&&(n.setContent(e[0].formatted_address),n.open(a,o),o.addListener("click",function(){n.open(a,o)}))}),a.setCenter(t),e("#"+this._inputLatSel).val(t.lat()),e("#"+this._inputLngSel).val(t.lng())},_selectRateRows:function(t){var o=e(t.currentTarget),a=o.closest("tbody").find("input[type=checkbox]"),n=o.closest("tbody").find("input[type=checkbox]:checked");n.length&&n.length===a.length?o.closest("table").find("thead input[type=checkbox]").prop("checked",!0):o.closest("table").find("thead input[type=checkbox]").prop("checked",!1),n.length?(o.closest("table").find(".button.remove_rows").show(),o.closest("table").find(".button.add").hide()):(o.closest("table").find(".button.remove_rows").hide(),o.closest("table").find(".button.add").show()),a.each(function(t,o){e(o).is(":checked")?e(o).closest("tr").addClass("selected"):e(o).closest("tr").removeClass("selected")})},_toggleRateRows:function(t){var o=e(t.currentTarget);o.is(":checked")?(o.closest("table").find("tr").addClass("selected").find("input[type=checkbox]").prop("checked",!0),o.closest("table").find("tbody input[type=checkbox]").length&&(o.closest("table").find(".button.remove_rows").show(),o.closest("table").find(".button.add").hide())):(o.closest("table").find("tr").removeClass("selected").find("input[type=checkbox]").prop("checked",!1),o.closest("table").find("tbody input[type=checkbox]").length&&(o.closest("table").find(".button.remove_rows").hide(),o.closest("table").find(".button.add").show()))},_addRateRows:function(t){t.preventDefault();var o=wp.template("rates-list-input-table-row"),a={field_key:e(t.currentTarget).data("key"),distance_unit:e("#woocommerce_wcsdm_gmaps_api_units").val(),charge_per_distance_unit:e("#woocommerce_wcsdm_charge_per_distance_unit").is(":checked")?e("#woocommerce_wcsdm_gmaps_api_units").val():""};e("#rates-list-table tbody").append(o(a))},_removeRateRows:function(t){t.preventDefault();var o=e(t.currentTarget);o.hide(),o.closest("table").find(".button.add").show(),o.closest("table").find("thead input[type=checkbox]").prop("checked",!1),o.closest("table").find("tbody input[type=checkbox]").each(function(t,o){e(o).is(":checked")&&e(o).closest("tr").remove()})},_encode:function(e){var t,o,a,n,r,s,c,i="",d=0;for(e=this._utf8_encode(e);d<e.length;)n=(t=e.charCodeAt(d++))>>2,r=(3&t)<<4|(o=e.charCodeAt(d++))>>4,s=(15&o)<<2|(a=e.charCodeAt(d++))>>6,c=63&a,isNaN(o)?s=c=64:isNaN(a)&&(c=64),i=i+this._keyStr.charAt(n)+this._keyStr.charAt(r)+this._keyStr.charAt(s)+this._keyStr.charAt(c);return i},_decode:function(e){var t,o,a,n,r,s,c="",i=0;for(e=e.replace(/[^A-Za-z0-9+/=]/g,"");i<e.length;)t=this._keyStr.indexOf(e.charAt(i++))<<2|(n=this._keyStr.indexOf(e.charAt(i++)))>>4,o=(15&n)<<4|(r=this._keyStr.indexOf(e.charAt(i++)))>>2,a=(3&r)<<6|(s=this._keyStr.indexOf(e.charAt(i++))),c+=String.fromCharCode(t),64!=r&&(c+=String.fromCharCode(o)),64!=s&&(c+=String.fromCharCode(a));return c=this._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",o=0;o<e.length;o++){var a=e.charCodeAt(o);a<128?t+=String.fromCharCode(a):a>127&&a<2048?(t+=String.fromCharCode(a>>6|192),t+=String.fromCharCode(63&a|128)):(t+=String.fromCharCode(a>>12|224),t+=String.fromCharCode(a>>6&63|128),t+=String.fromCharCode(63&a|128))}return t},_utf8_decode:function(e){for(var t="",o=0,a=0,n=0;o<e.length;)(a=e.charCodeAt(o))<128?(t+=String.fromCharCode(a),o++):a>191&&a<224?(n=e.charCodeAt(o+1),t+=String.fromCharCode((31&a)<<6|63&n),o+=2):(n=e.charCodeAt(o+1),c3=e.charCodeAt(o+2),t+=String.fromCharCode((15&a)<<12|(63&n)<<6|63&c3),o+=3);return t}};e(document).ready(function(){t.init(wcsdm_params)})}(jQuery);