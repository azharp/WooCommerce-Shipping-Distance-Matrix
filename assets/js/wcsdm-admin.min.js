!function(e){"use strict";var t={inputApiKeyId:"woocommerce_wcsdm_gmaps_api_key",inputLatId:"woocommerce_wcsdm_origin_lat",inputLngId:"woocommerce_wcsdm_origin_lng",mapWrapperId:"wcsdm-map-wrapper",mapSearchId:"wcsdm-map-search",mapCanvasId:"wcsdm-map-canvas",zoomLevel:16,init:function(){var t=this;wcsdm_params.show_settings&&setTimeout(function(){for(var t=!1,a=e(document).find(".wc-shipping-zone-method-type"),o=0;o<a.length;o++){var n=a[o];if(e(n).text()==wcsdm_params.method_title)return e(n).closest("tr").find(".row-actions .wc-shipping-zone-method-settings").trigger("click"),void(t=!0)}t||(e(".wc-shipping-zone-add-method").trigger("click"),e("select[name='add_method_id']").val(wcsdm_params.method_id).trigger("change"))},200),e(document).on("click",".wc-shipping-zone-method-settings",function(){e(this).closest("tr").find(".wc-shipping-zone-method-type").text()===wcsdm_params.method_title&&(e("#"+t.mapCanvasId).remove(),e("#"+t.mapSearchId).remove(),e("#"+t.inputApiKeyId).trigger("change"))}),e(document).on("change","#"+t.inputApiKeyId,function(){t._loadScript(e(this).val())}),e(document).on("click","#rates-list-table tbody .select-item",t._selectRateRows),e(document).on("click","#rates-list-table thead .select-item",t._toggleRateRows),e(document).on("click","#rates-list-table a.add",t._addRateRows),e(document).on("click","#rates-list-table a.remove_rows",t._removeRateRows)},_loadScript:function(t){var a=this;"undefined"!=typeof google&&void 0!==google.maps&&(window.google.maps={});try{var o="https://maps.googleapis.com/maps/api/js?key="+t+"&libraries=geometry,places";e.getScript(o,function(){a._buildMap()})}catch(e){console.log("error_buildMap",e)}},_buildMap:function(){var t=this,a=e("#"+t.inputLatId).val(),o=e("#"+t.inputLngId).val(),n={lat:a=a.length?parseFloat(a):-6.175392,lng:o=o.length?parseFloat(o):106.827153},s=wp.template(t.mapCanvasId),c=wp.template(t.mapSearchId);e("#"+t.mapCanvasId).length||e("#"+t.mapWrapperId).append(s({map_canvas_id:t.mapCanvasId}));var d=[],i=new google.maps.Map(document.getElementById(t.mapCanvasId),{center:n,zoom:t.zoomLevel,mapTypeId:"roadmap"}),r=new google.maps.Marker({map:i,position:n,draggable:!0,icon:wcsdm_params.marker}),p=new google.maps.InfoWindow({maxWidth:350,content:wcsdm_params.txt.drag_marker});p.open(i,r),google.maps.event.addListener(r,"dragstart",function(e){p.close()}),google.maps.event.addListener(r,"dragend",function(e){t._setLatLng(e.latLng,r,i,p)}),d.push(r),e("#"+t.mapSearchId).length||e("#"+t.mapWrapperId).append(c({map_search_id:t.mapSearchId}));var l=document.getElementById(t.mapSearchId),m=new google.maps.places.SearchBox(l);i.controls[google.maps.ControlPosition.TOP_LEFT].push(l),i.addListener("bounds_changed",function(){m.setBounds(i.getBounds())}),m.addListener("places_changed",function(){var e=m.getPlaces();if(0!==e.length){d.forEach(function(e){e.setMap(null)}),d=[];var a=new google.maps.LatLngBounds;e.forEach(function(e){e.geometry?(r=new google.maps.Marker({map:i,position:e.geometry.location,draggable:!0,icon:wcsdm_params.marker}),t._setLatLng(e.geometry.location,r,i,p),google.maps.event.addListener(r,"dragstart",function(e){p.close()}),google.maps.event.addListener(r,"dragend",function(e){t._setLatLng(e.latLng,r,i,p)}),d.push(r),e.geometry.viewport?a.union(e.geometry.viewport):a.extend(e.geometry.location)):console.log("Returned place contains no geometry")}),i.setZoom(t.zoomLevel),i.fitBounds(a)}})},_setLatLng:function(t,a,o,n){var s=this;(new google.maps.Geocoder).geocode({latLng:t},function(c,d){d==google.maps.GeocoderStatus.OK&&(c[0]?(n.setContent(c[0].formatted_address),n.open(o,a),e("#"+s.inputLatId).val(t.lat()),e("#"+s.inputLngId).val(t.lng())):(e("#"+s.inputLatId).val(""),e("#"+s.inputLngId).val("")))}),o.setCenter(t)},_selectRateRows:function(t){var a=e(t.currentTarget),o=a.closest("tbody").find("input[type=checkbox]"),n=a.closest("tbody").find("input[type=checkbox]:checked");n.length&&n.length===o.length?a.closest("table").find("thead input[type=checkbox]").prop("checked",!0):a.closest("table").find("thead input[type=checkbox]").prop("checked",!1),o.each(function(t,a){e(a).is(":checked")?e(a).closest("tr").addClass("selected"):e(a).closest("tr").removeClass("selected")})},_toggleRateRows:function(t){var a=e(t.currentTarget);a.is(":checked")?a.closest("table").find("tr").addClass("selected").find("input[type=checkbox]").prop("checked",!0):a.closest("table").find("tr").removeClass("selected").find("input[type=checkbox]").prop("checked",!1)},_addRateRows:function(t){t.preventDefault();var a=e(t.currentTarget),o=wp.template("rates-list-input-table-row")({field_key:a.data("key")});e("#rates-list-table tbody").append(o)},_removeRateRows:function(t){t.preventDefault();var a=e(t.currentTarget);a.closest("table").find("thead input[type=checkbox]").prop("checked",!1),a.closest("table").find("tbody input[type=checkbox]").each(function(t,a){e(a).is(":checked")&&e(a).closest("tr").remove()})}};e(document).ready(function(){t.init()})}(jQuery);